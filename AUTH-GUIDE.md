# نظام المصادقة (Authentication System)

## نظرة عامة
النظام يستخدم **NextAuth** مع استراتيجية JWT لإدارة المصادقة والتفويض.

## معلومات تسجيل الدخول التجريبية

### حساب المسؤول (Admin)
```
البريد الإلكتروني: admin@example.com
كلمة المرور: admin123
الدور: مسؤول النظام
```

### حساب المعلم (Teacher)
```
البريد الإلكتروني: teacher@example.com
كلمة المرور: teacher123
الدور: معلم
```

## المميزات الرئيسية

### 1. تسجيل الدخول
- صفحة تسجيل دخول في `/login`
- استخدام بيانات اعتماد البريد الإلكتروني وكلمة المرور
- إعادة التوجيه التلقائي إلى `/dashboard` بعد النجاح
- رسائل خطأ واضحة للمستخدم

### 2. التسجيل (Register)
- صفحة تسجيل جديد في `/register`
- التحقق من:
  - عدم تكرار البريد الإلكتروني
  - حد أدنى لطول كلمة المرور (6 أحرف)
  - تطابق كلمات المرور
- تشفير كلمات المرور باستخدام **bcryptjs**
- إعادة التوجيه إلى صفحة تسجيل الدخول بعد النجاح

### 3. الأدوار (Roles)
يدعم ثلاثة أدوار:
- **admin**: مسؤول النظام (دخول كامل)
- **teacher**: معلم (دخول محدود)
- **user**: مستخدم عادي (دخول محدود)

### 4. حماية الصفحات (Role Guard)
استخدم مكون `RoleGuard` لحماية الصفحات:

```tsx
import RoleGuard from '@/components/shared/RoleGuard';

export default function AdminPage() {
  return (
    <RoleGuard requiredRole="admin">
      <YourComponent />
    </RoleGuard>
  );
}
```

## ملفات النظام

### ملفات المفتاح
- `src/app/api/auth/[...nextauth]/route.ts` - معالج NextAuth
- `src/app/api/register/route.ts` - نقطة نهاية التسجيل
- `src/app/(auth)/login/page.tsx` - صفحة تسجيل الدخول
- `src/app/(auth)/register/page.tsx` - صفحة التسجيل الجديد
- `src/app/admin/page.tsx` - لوحة تحكم المشرف
- `src/components/shared/RoleGuard.tsx` - مكون حماية الأدوار
- `src/lib/users.json` - قاعدة بيانات المستخدمين المحلية

## التكوين المطلوب

### متغيرات البيئة (.env.local)
```
NEXTAUTH_SECRET=أنشئ مفتاح سري عشوائي
NEXTAUTH_URL=http://localhost:3000
```

لإنشاء `NEXTAUTH_SECRET`:
```bash
openssl rand -base64 32
```

## كيفية الاستخدام

### 1. تسجيل الدخول
1. اذهب إلى `http://localhost:3000/login`
2. أدخل بيانات الاعتماد
3. سيتم إعادة توجيهك إلى `/dashboard` عند النجاح

### 2. التسجيل (للمستخدمين الجدد)
1. اذهب إلى `http://localhost:3000/register`
2. أدخل بيانات حسابك
3. سيتم إرسالك إلى صفحة تسجيل الدخول

### 3. الوصول إلى لوحة تحكم المشرف
```bash
# في الإنتاج، تأكد من إعداد المستخدمين مع دور 'admin'
# استخدم حساب المسؤول:
# البريد: admin@example.com
# كلمة المرور: admin123
```

## نقاط قوة النظام
✅ تشفير كلمات المرور آمن  
✅ JWT-based sessions  
✅ حماية القائمة البيضاء للأدوار  
✅ إعادة توجيه تلقائية بناءً على الصلاحيات  
✅ دعم تسجيل الخروج  

## ملاحظات أمان هامة
⚠️ **في الإنتاج:**
- استخدم قاعدة بيانات حقيقية بدلاً من `users.json`
- استخدم خدمة مصادقة احترافية (Firebase, Auth0, إلخ)
- قم بتفعيل HTTPS
- استخدم `NEXTAUTH_SECRET` قوياً
- أضف رموز التحديث (Refresh Tokens)
